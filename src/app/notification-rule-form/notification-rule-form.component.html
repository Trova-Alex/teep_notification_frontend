<div class="min-h-screen w-full bg-gray-50 flex flex-col items-center justify-start p-8">
  <h2 class="text-3xl font-bold text-blue-700 mb-8 text-left w-full border-b pb-4">
    {{ regra.identification ? 'Editar Regra de Notificação' : 'Nova Regra de Notificação' }}
  </h2>
  <form (ngSubmit)="salvarRegra()" class="flex flex-col gap-8 w-full">
    <div class="grid grid-cols-2 gap-6 w-full">
      <!-- Campos principais -->
      <label class="flex flex-col">
        <span class="mb-2 text-gray-700 font-semibold">Nome</span>
        <input [(ngModel)]="regra.identification" name="nome" required class="border rounded px-3 py-2 focus:ring focus:border-blue-500" />
      </label>
      <label class="flex flex-col">
        <span class="mb-2 text-gray-700 font-semibold">Prioridade</span>
        <select [(ngModel)]="regra.priority" name="priority" required class="border rounded px-3 py-2 focus:ring focus:border-blue-500">
          <option value="" disabled selected>Selecione...</option>
          <option value="high">Alta</option>
          <option value="normal">Normal</option>
        </select>
      </label>
      <label class="flex flex-col">
        <span class="mb-2 text-gray-700 font-semibold">Notificar a cada (minutos)</span>
        <input type="number" [(ngModel)]="regra.notify_every" name="notificarCada" min="0" class="border rounded px-3 py-2 focus:ring focus:border-blue-500" />
      </label>
      <label class="flex flex-col">
        <span class="mb-2 text-gray-700 font-semibold">Notificar após (minutos)</span>
        <input type="number" [(ngModel)]="regra.notify_after" name="notificarApos" min="0" class="border rounded px-3 py-2 focus:ring focus:border-blue-500" />
      </label>
      <label class="flex flex-col col-span-2">
        <span class="mb-2 text-gray-700 font-semibold">Tipo de Notificação</span>
        <select [(ngModel)]="regra.type" name="tipo" required class="border rounded px-3 py-2 focus:ring focus:border-blue-500">
          <option value="" disabled selected>Selecione...</option>
          <option value="stop">Parada</option>
          <option value="moldlife">Manutenção</option>
        </select>
      </label>
    </div>

    <!-- Card de seleção de pares -->
    <div class="bg-gray-100 rounded-lg p-6 mb-4">
      <h3 class="text-lg font-bold text-gray-700 mb-4">Adicionar Par Máquina / Motivo de Parada</h3>
      <div class="flex flex-row gap-4 items-end mb-6 w-full">
        <label class="flex flex-col flex-1">
          <span class="mb-1 text-gray-700">Máquina</span>
          <select [(ngModel)]="selectedMachine" name="selectedMachine" class="border rounded px-3 py-2 focus:ring focus:border-blue-500">
            <option value="" disabled selected>Selecione...</option>
            <option *ngFor="let machine of machines" [value]="machine.code">[{{ machine.code }}] - {{ machine.description }}</option>
          </select>
        </label>
        <label class="flex flex-col flex-1">
          <span class="mb-1 text-gray-700">Motivo de Parada</span>
          <select [(ngModel)]="selectedStopReason" name="selectedStopReason" class="border rounded px-3 py-2 focus:ring focus:border-blue-500">
            <option value="" disabled selected>Selecione...</option>
            <option *ngFor="let reason of stopReasons" [value]="reason.code">[{{ reason.code }}] - {{ reason.description }}</option>
          </select>
        </label>
        <button (click)="adicionarPar()" type="button" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition shadow">
          Adicionar
        </button>
      </div>

      <div *ngIf="mensagemErro" class="text-red-600 mb-2">{{ mensagemErro }}</div>

      <!-- Lista de pares adicionados -->
      <ul class="mb-2 w-full max-h-[500px] overflow-y-auto">
        <li *ngFor="let par of paresStopResource" class="flex flex-row justify-between items-center mb-2 bg-white rounded px-3 py-2 shadow-sm">
          <div class="flex flex-row items-center justify-center flex-1 gap-4">
            <span class="font-medium text-gray-800 text-center">[{{ par.machineCode }}] - {{ par.machineDescription }}</span>
            <span class="text-gray-500">/</span>
            <span class="font-medium text-gray-800 text-center">[{{ par.stopReasonCode }}] - {{ par.stopReasonDescription }}</span>
          </div>
          <button (click)="removerPar(par)" type="button" class="ml-4 text-red-600 hover:underline text-sm">
            Remover
          </button>
        </li>
      </ul>
    </div>

    <!-- Lista de usuários para seleção -->
    <div class="bg-gray-100 rounded-lg p-6 mt-4">
      <h3 class="text-lg font-bold text-gray-700 mb-4">Selecionar Usuários para Notificação</h3>
      <ul class="mb-2 w-full max-h-[300px] overflow-y-auto">
        <li *ngFor="let usuario of users" class="flex items-center mb-2">
          <input
            type="checkbox"
            [value]="usuario.id"
            [(ngModel)]="usuario.selecionado"
            name="usuario_{{usuario.id}}"
            (change)="atualizarUsuariosSelecionados(usuario)"
            class="mr-2"
          />
          <span class="font-medium text-gray-800">{{ usuario.name }}</span>
          <span class="text-gray-500 ml-2">[{{ usuario.email }}]</span>
        </li>
      </ul>
    </div>

    <!-- Opções de notificação -->
    <div class="flex flex-row gap-8 justify-center w-full bg-gray-100 rounded-lg p-4">
      <label class="flex items-center gap-2">
        <input type="checkbox" [(ngModel)]="regra.activ" name="ativo" />
        <span>Ativo</span>
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" [(ngModel)]="regra.init" name="notificarInicio" />
        <span>Notificar Início</span>
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" [(ngModel)]="regra.end" name="notificarFim" />
        <span>Notificar Fim</span>
      </label>
    </div>
    <div class="flex flex-row justify-end w-full mt-4 gap-4">
      <button type="button" (click)="salvarRegra(true)"  class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded transition shadow">
        Salvar
      </button>
      <button type="button" (click)="salvarRegra()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded transition shadow">
        Salvar e Criar novo
      </button>
    </div>
  </form>
</div>
